experiment:
  dataset: electricity
  stations: [electricity]
  models: [transformer, saits]
  features: []
  never_mask_features: []
  block_size: 24
  step_size: 1
  seed: 42

training:
  epochs: 100
  batch_size: 256
  lr: 0.0008
  patience: 20
  min_delta: 0.0001
  train_mask:
    transformer:
      mode: random
      missing_rate: 0.2
      block_min_len: 2
      block_max_len: 14
      block_missing_prob: 0.35
      feature_block_prob: 0.6
      block_no_overlap: true
    saits:
      mode: random
      missing_rate: 0.2
  shared_validation_mask:
    missing_rate: 0.2
    mask_mode: random
    block_min_len: 2
    block_max_len: 14
    block_missing_prob: 0.35
    feature_block_prob: 0.6
    block_no_overlap: true

evaluation:
  missing_rate: 0.2
  mask_mode: random
  block_min_len: 2
  block_max_len: 14
  block_missing_prob: 0.35
  feature_block_prob: 0.6
  block_no_overlap: true
  model_ids:
    transformer: null
    saits: null
  evaluation:
    mlflow_model_refs:
      transformer: null
      saits: null

# "runs:/172d03a272524741b1cf6a2f4d3ea4fc/model/files/saits.pt"

models:
  transformer:
    type: classic_transformer
    checkpoint_name: transformer.pt
    params:
      d_model: 128
      n_layer: 4
      n_head: 4
      dropout: 0.1
      bias: true
      norm_eps: 0.000001
      use_torch_compile: true
      compile_mode: reduce-overhead
      compile_dynamic: false
      optimizer_fused: true
      optimizer_weight_decay: 0.01
      scheduler_warmup_ratio: 0.125
      scheduler_warmup_start_factor: 0.3
      scheduler_min_lr: 0.0000001
      grad_clip_norm: 0.5
      dataloader_num_workers: -1
      dataloader_prefetch_factor: 4
      dataloader_persistent_workers: true
      dataloader_pin_memory: true
  saits:
    type: saits
    checkpoint_name: saits.pt
    params:
      # Architecture
      d_model: 128
      n_layers: 4
      n_head: 4
      dropout: 0.1
      attn_dropout: 0.1
      diagonal_attention_mask: true
      d_ffn: 512

      # Objective weights
      ORT_weight: 1.0
      MIT_weight: 1.0

      # Losses/metrics
      training_loss: MAE
      validation_metric: MAE

      # Runtime
      num_workers: 0
      saving_path: null
      model_saving_strategy: best
      verbose: true

      # Optimizer
      optimizer: adam
      optimizer_weight_decay: 0.01
      optimizer_betas: [0.9, 0.999]
      optimizer_eps: 0.00000001
      learning_rate: null

paths:
  data_dir: data/raw
  processed_dir: data/processed/splits
  scalers_dir: data/processed/scalers
  models_dir: artifacts/models
  reports_dir: reports/model_eval
  plots_dir: reports/plots/model_eval
  metrics_dir: reports/metrics

dataset:
  definitions:
    air_quality:
      loader: air_quality_csv
      data_dir: data/raw
      feature_names: [PM10, PM2.5, temperature, rain, pressure, precipitation, wind_speed, clouds, wind_direction]
    electricity:
      loader: npz
      npz_path: data/datasets/electricity/npz/electricity.npz
      data_dir: data/datasets/electricity/materialized
      feature_names: [MT_001, MT_002, MT_003, MT_004, MT_005, MT_006, MT_007, MT_008, MT_009, MT_010, MT_011, MT_012, MT_013, MT_014, MT_015, MT_016]
      value_key: X
      datetime_key: datetime
      feature_names_key: feature_names
      ensure:
        kind: electricity_uci
        cache_dir: data/datasets/electricity/cache
        start_client: 1
        n_clients: 16
        resample_frequency: 1h
    physionet2012:
      loader: npz
      npz_path: data/datasets/physionet2012/npz/physionet2012.npz
      data_dir: data/datasets/physionet2012/materialized
      value_key: X
      datetime_key: datetime
      feature_names_key: feature_names
    ett:
      loader: npz
      npz_path: data/datasets/ett/npz/ett.npz
      data_dir: data/datasets/ett/materialized
      value_key: X
      datetime_key: datetime
      feature_names_key: feature_names

tracking:
  enabled: true
  repo_owner: PetelinekBenjamin
  repo_name: air-quality-missing-data-imputation
  experiment_name: air-quality-imputer
  register_models: true
